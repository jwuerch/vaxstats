<!DOCTYPE html>
<html>
<head>
	<link href="style.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js"></script>
	<script src="vaccinations.js"></script>
	<script src="populations.js"></script>

<body>

<div class="header">
	<h1>COVID Vax Stats By Country</h1>
	<p> Last Updated: March 16, 2022</p>
</div>

<table class="table table-striped">
	<tbody>
	<tr class="bg-info">
		<th data-column="country" data-order="desc">Country</th>
		<th data-column="population" data-order="desc">Population 2020</th>
		<th data-column="date" data-order="desc">Last Update</th>
		<th data-column="first-dose" data-order="desc">I Hate Myself (First Dose)</th>
		<th data-column="second-dose" data-order="desc">I Want AIDs (Second Dose)</th>
	</tr>
	</tbody>
	<tbody id="myTable">
	</tbody>
	
</table>

<script>
	var merged = _.merge(_.keyBy(vaxArray, 'iso_code'), _.keyBy(popArray, 'countryiso3code'));
	var newArray = _.values(merged);
	buildTable(newArray);
	function buildTable(data) {
		var table = document.getElementById('myTable');
		table.innerHTML = '';
		for ( i = 0; i < data.length - 1; i++) {

			/** Country Name **/
			if (data[i].country.value == null) {
				var country_name = data[i].country;
			} else {
				var country_name = data[i].country.value;
			}

			/** Population **/
			if (data[i].value == null) {
				var population = '';
			} else {
				var population = data[i].value;
			}

			/** Last Updated Date, Single Dose & Double Dose **/
			var updated_date_length = data[i].data.length - 1;
			var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			if (has_data == null) {
				var updated_date_length = data[i].data.length -2;
				var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			}
			if (has_data == null) {
				var updated_date_length = data[i].data.length -3;
				var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			}
			if (has_data == null) {
				var updated_date_length = data[i].data.length -4;
				var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			}
			if (has_data == null) {
				var updated_date_length = data[i].data.length -5;
				var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			}
			if (has_data == null) {
				var updated_date_length = data[i].data.length -6;
				var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			}
			if (has_data == null) {
				var updated_date_length = data[i].data.length -7;
				var has_data = data[i].data[updated_date_length].people_fully_vaccinated;
			}
			if (has_data == null) {
				var single_dose = '';
				var double_dose = '';
				var updated_date = '';
			} else {
				var single_dose = data[i].data[updated_date_length].people_vaccinated;
				var double_dose = data[i].data[updated_date_length].people_fully_vaccinated;
				var updated_date = data[i].data[updated_date_length].date;
			}

			var single_dose = ( (single_dose / population) * 100).toFixed(2) + '%';
			var double_dose = ( (double_dose / population) * 100).toFixed(2) + '%';
			if (double_dose == null || double_dose == 'Infinity%') {
				single_dose = '';
				double_dose = '';
			}
			if (single_dose == 'NaN%') {
				single_dose = '';
			}
			var population = population.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			var row = `<tr>
							<td>${country_name}</td>
							<td>${population}</td>
							<td>${updated_date}</td>
							<td>${single_dose}</td>
							<td>${double_dose}</td>
		
					   </tr>`
			table.innerHTML += row;
		}
	}



</script>

<script src="scripts.js"></script>
</body>
</html>